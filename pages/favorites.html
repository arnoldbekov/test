<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ ‚Äî HistoryTravel</title>
  <meta name="description" content="HistoryTravel ‚Äî –≤–∞—à–∏ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–∏—è –∏ –º–∞—Ä—à—Ä—É—Ç—ã.">
  <link rel="stylesheet" href="../styles/style.css?v=12">
  <link rel="icon" href="../assets/img/logo.png" type="image/png" sizes="32x32">
  <link rel="shortcut icon" href="../assets/img/logo.png" type="image/png">
  <link rel="apple-touch-icon" href="../assets/img/logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lora:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>

<header class="header">
  <div class="container header-inner header__inner">
    <a href="../index.html" class="logo-link header__logo-link"><img src="../assets/img/logo.png" alt="HistoryTravel" class="logo-img header__logo-img"></a>
    <button class="header__menu-toggle" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é" aria-expanded="false" id="menuToggle">
      <span class="header__menu-icon"></span>
      <span class="header__menu-icon"></span>
      <span class="header__menu-icon"></span>
    </button>
    <nav class="nav header__nav" aria-label="–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è —Å–∞–π—Ç–∞" id="mainNav">
      <a href="../index.html#map" class="header__nav-link">–ö–∞—Ä—Ç–∞</a>
      <a href="periods.html" class="header__nav-link">–≠–ø–æ—Ö–∏</a>
      <a href="routes.html" class="header__nav-link">–ú–∞—Ä—à—Ä—É—Ç—ã</a>
      <a href="gallery.html" class="header__nav-link">–ì–∞–ª–µ—Ä–µ—è</a>
      <a href="favorites.html" class="header__nav-link">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
      <a href="about.html" class="header__nav-link">–û –ø—Ä–æ–µ–∫—Ç–µ</a>
    </nav>
  </div>
</header>

<main>
  <section class="favorites-section favorites" aria-labelledby="favorites-title" data-aos="fade-up">
    <div class="container">
      <h2 id="favorites-title">–ò–∑–±—Ä–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏ –º–∞—Ä—à—Ä—É—Ç—ã</h2>
      <p class="section-lead">–ó–¥–µ—Å—å —Å–æ–±—Ä–∞–Ω—ã –≤–∞—à–∏ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–∏—è –∏ –º–∞—Ä—à—Ä—É—Ç—ã. –í—ã –º–æ–∂–µ—Ç–µ —É–¥–∞–ª–∏—Ç—å –∏—Ö –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ, –Ω–∞–∂–∞–≤ –Ω–∞ –∏–∫–æ–Ω–∫—É —Å–µ—Ä–¥—Ü–∞.</p>

      <div class="favorites-tabs favorites__tabs" role="tablist" aria-label="–í–∫–ª–∞–¥–∫–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ">
        <button class="tab-btn favorites__tab-btn active" data-tab="places" role="tab" aria-selected="true">–û–±—ä–µ–∫—Ç—ã</button>
        <button class="tab-btn favorites__tab-btn" data-tab="routes" role="tab" aria-selected="false">–ú–∞—Ä—à—Ä—É—Ç—ã</button>
      </div>

      <div class="favorites-content favorites__content">
        <div id="favoritesPlaces" class="tab-content favorites__tab-content active" role="tabpanel" aria-labelledby="tab-places">
          <div class="objects-grid objects__grid" id="favoritesPlacesGrid">
          </div>
          <p class="empty-message" id="emptyPlaces" style="display: none;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –æ–±—ä–µ–∫—Ç—ã –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ, –Ω–∞–∂–∞–≤ –Ω–∞ –∏–∫–æ–Ω–∫—É —Å–µ—Ä–¥—Ü–∞ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –æ–±—ä–µ–∫—Ç–∞.</p>
        </div>

        <div id="favoritesRoutes" class="tab-content favorites__tab-content" role="tabpanel" aria-labelledby="tab-routes" style="display: none;">
          <div id="favoritesRoutesList">
          </div>
          <p class="empty-message" id="emptyRoutes" style="display: none;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –º–∞—Ä—à—Ä—É—Ç—ã –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ, –Ω–∞–∂–∞–≤ –Ω–∞ –∏–∫–æ–Ω–∫—É —Å–µ—Ä–¥—Ü–∞ —Ä—è–¥–æ–º —Å –º–∞—Ä—à—Ä—É—Ç–æ–º.</p>
        </div>
      </div>
    </div>
  </section>
</main>

<div class="modal" id="objectModal" aria-hidden="true">
  <div class="modal-dialog" role="dialog" aria-labelledby="objTitle" aria-modal="true">
    <button class="close" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–∞">√ó</button>
    <h2 id="objTitle"></h2>
    <div id="objContent"></div>
  </div>
</div>

<div class="modal" id="compareModal" aria-hidden="true">
  <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="compareTitle">
    <button class="close" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è">√ó</button>
    <h3 id="compareTitle">–¢–æ–≥–¥–∞ –∏ —Å–µ–π—á–∞—Å</h3>
    <div class="compare" id="compareContainer"></div>
  </div>
</div>

<div class="modal" id="routeModal" aria-hidden="true">
  <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="routeModalTitle">
    <button class="close" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞">√ó</button>
    <h3 id="routeModalTitle">–°–æ–∑–¥–∞—Ç—å —Å–≤–æ–π –º–∞—Ä—à—Ä—É—Ç</h3>
    <p class="route-modal-hint">–û—Ç–º–µ—Ç—å—Ç–µ –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç–∏—Ç–µ –≤–∫–ª—é—á–∏—Ç—å –≤ –º–∞—Ä—à—Ä—É—Ç, –∑–∞—Ç–µ–º –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ.</p>
    <div id="routeChecklist" class="route-checklist" aria-label="–°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞"></div>
    <div class="route-start-point">
      <label class="route-name-label">–ù–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞</label>
      <button id="selectStartPoint" type="button" class="btn-secondary">–£–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ</button>
      <span id="startPointDisplay" class="start-point-display"></span>
    </div>
    <label class="route-name-label" for="routeNameInput">–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞</label>
    <input id="routeNameInput" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, ¬´–í—ã—Ö–æ–¥–Ω—ã–µ –≤ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–º —Ü–µ–Ω—Ç—Ä–µ¬ª">
    <button id="saveRoute" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç</button>
  </div>
</div>

<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script src="../js/core/map-renderer.js"></script>
<script src="../js/core/script.js"></script>
<script type="module" src="../js/blocks/mobile-init.js"></script>
<script type="module" src="../js/core/main.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  try {
    // –û—Ç–∫–ª—é—á–∞–µ–º AOS –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    const isMobile = window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    if (window.AOS && !isMobile) {
      AOS.init({ duration: 800, once: true, offset: 100 });
    }
    
    // –í—Å–µ–≥–¥–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
    if (typeof initMobileMenu === 'function') {
      initMobileMenu();
    }

    function loadPlacesData() {
      if (typeof axios !== 'undefined') {
        axios.get('../data/sites.json')
          .then(response => {
            const data = response.data;
            if (Array.isArray(data) && data.length > 0) {
              if (typeof places !== 'undefined') {
                places = data;
              } else {
                window.places = data;
              }
              initFavoritesPage();
            } else {
              console.error('–î–∞–Ω–Ω—ã–µ –≤ sites.json –ø—É—Å—Ç—ã –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã');
              alert('–î–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª–µ sites.json –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã.');
            }
          })
          .catch(err => {
            console.warn('Axios –Ω–µ —Å–º–æ–≥ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ fetch:', err);
            loadPlacesDataFallback();
          });
      } else {
        loadPlacesDataFallback();
      }
    }

    function loadPlacesDataFallback() {
      fetch('../data/sites.json')
        .then(resp => {
          if (!resp.ok) {
            throw new Error(`HTTP error! status: ${resp.status}`);
          }
          return resp.json();
        })
        .then(data => {
          if (Array.isArray(data) && data.length > 0) {
            if (typeof places !== 'undefined') {
              places = data;
            } else {
              window.places = data;
            }
            initFavoritesPage();
          } else {
            console.error('–î–∞–Ω–Ω—ã–µ –≤ sites.json –ø—É—Å—Ç—ã –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã');
            alert('–î–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª–µ sites.json –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã.');
          }
        })
        .catch(err => {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ data/sites.json:', err);
          const errorMsg = err.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
          const isCorsError = errorMsg.includes('CORS') || errorMsg.includes('Failed to fetch');
          const is404Error = errorMsg.includes('404') || errorMsg.includes('status: 404');
          
          let userMessage = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –Ω–∞—Å–ª–µ–¥–∏—è—Ö. ';
          if (isCorsError || window.location.protocol === 'file:') {
            userMessage += '–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–∞–π—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, Live Server –≤ VS Code –∏–ª–∏ python -m http.server).';
          } else if (is404Error) {
            userMessage += '–§–∞–π–ª data/sites.json –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.';
          } else {
            userMessage += `–û—à–∏–±–∫–∞: ${errorMsg}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª data/sites.json —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω.`;
          }
          alert(userMessage);
        });
    }

    if (typeof places === 'undefined') {
      window.places = [];
    }
    
    loadPlacesData();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:', error);
    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.');
  }
});

function initFavoritesPage() {
  if (typeof setupFavoritesTabs === 'function') {
    setupFavoritesTabs();
  }
  renderFavoritesPlaces();
  renderFavoritesRoutes();
  if (typeof setupModals === 'function') {
    setupModals();
  }
  
  const saveRouteBtn = document.getElementById('saveRoute');
  if (saveRouteBtn && typeof saveCustomRoute === 'function') {
    saveRouteBtn.addEventListener('click', saveCustomRoute);
  }
}

function setupFavoritesTabs() {
  const tabs = document.querySelectorAll('.favorites__tab-btn');
  const contents = document.querySelectorAll('.favorites__tab-content');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const targetTab = tab.dataset.tab;

      tabs.forEach(t => {
        t.classList.remove('active');
        t.setAttribute('aria-selected', 'false');
      });
      tab.classList.add('active');
      tab.setAttribute('aria-selected', 'true');

      contents.forEach(content => {
        content.style.display = 'none';
      });
      const targetContent = document.getElementById(`favorites${targetTab.charAt(0).toUpperCase() + targetTab.slice(1)}`);
      if (targetContent) {
        targetContent.style.display = 'block';
      }
    });
  });
}

function renderFavoritesPlaces() {
  const grid = document.getElementById('favoritesPlacesGrid');
  const emptyMsg = document.getElementById('emptyPlaces');
  if (!grid) return;

  const placesData = typeof places !== 'undefined' ? places : (window.places || []);
  if (!Array.isArray(placesData) || placesData.length === 0) {
    console.error('–î–∞–Ω–Ω—ã–µ –æ –º–µ—Å—Ç–∞—Ö –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
    grid.style.display = 'none';
    if (emptyMsg) emptyMsg.style.display = 'block';
    return;
  }

  if (typeof getFavorites !== 'function') {
    console.error('–§—É–Ω–∫—Ü–∏—è getFavorites –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
    return;
  }

  const favorites = getFavorites();
  const favoritePlaces = placesData.filter(p => favorites.places.includes(p.id));

  if (favoritePlaces.length === 0) {
    grid.style.display = 'none';
    emptyMsg.style.display = 'block';
    return;
  }

  grid.style.display = 'grid';
  emptyMsg.style.display = 'none';

  const getPeriodNameFunc = typeof getPeriodName === 'function' ? getPeriodName : (p) => p || '';
  const getTypeNameFunc = typeof getTypeName === 'function' ? getTypeName : (t) => t || '';

  const normalizeImagePathFunc = typeof normalizeImagePath === 'function' ? normalizeImagePath : (path) => {
    if (!path) return '';
    if (path.startsWith('http://') || path.startsWith('https://')) return path;
    const isInPages = window.location.pathname.includes('/pages/');
    if (path.startsWith('image/')) {
      return isInPages ? `../${path}` : path;
    }
    return isInPages ? `../${path}` : path;
  };
  
  grid.innerHTML = favoritePlaces.map(place => {
    const hasImage = place.images && place.images.now && place.images.now.trim() !== '';
    const hasOldImage = place.images && place.images.old && place.images.old.trim() !== '';
    const hasBothImages = hasOldImage && hasImage;
    return `
      <article class="gallery-card" itemscope itemtype="https://schema.org/TouristAttraction" tabindex="0" aria-label="${hasBothImages ? '–°—Ä–∞–≤–Ω–∏—Ç—å —Ç–æ–≥–¥–∞ –∏ —Å–µ–π—á–∞—Å' : '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–æ—Ç–æ'}: ${place.name || ''}">
        ${hasImage ? `
        <div class="gallery-thumb">
          <img src="${normalizeImagePathFunc(place.images.now)}" alt="${place.name || ''}" loading="lazy" onerror="this.style.display='none'">
          <button class="favorite-btn gallery-favorite active" data-id="${place.id}" data-type="place" aria-label="–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ" title="–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
            </svg>
          </button>
        </div>
        ` : ''}
        <h3 itemprop="name">${place.name || ''}</h3>
        <p itemprop="temporalCoverage">${getPeriodNameFunc(place.period)} ‚Ä¢ ${getTypeNameFunc(place.type)}</p>
        ${place.address ? `<meta itemprop="address" content="${place.address}">` : ''}
        <button type="button" class="btn-secondary" data-id="${place.id}" data-has-old="${hasOldImage}">${hasBothImages ? '–¢–æ–≥–¥–∞ –∏ —Å–µ–π—á–∞—Å' : '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–æ—Ç–æ'}</button>
      </article>
    `;
  }).join('');

  grid.querySelectorAll('button.btn-secondary[data-id]').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = Number(btn.dataset.id);
      const placesData = typeof places !== 'undefined' ? places : (window.places || []);
      const place = placesData.find(p => p.id === id);
      if (place) {
        if (btn.dataset.hasOld === 'true') {
          if (typeof window.openCompareModal === 'function') {
            window.openCompareModal(place);
          }
        } else {
          if (typeof window.openSingleImageModal === 'function') {
            window.openSingleImageModal(place);
          }
        }
      }
    });
  });

  grid.querySelectorAll('.favorite-btn[data-type="place"]').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const id = Number(btn.dataset.id);
      if (typeof togglePlaceFavorite === 'function') {
        togglePlaceFavorite(id);
        renderFavoritesPlaces();
      }
    });
  });
}

function renderFavoritesRoutes() {
  const container = document.getElementById('favoritesRoutesList');
  const emptyMsg = document.getElementById('emptyRoutes');
  if (!container) return;

  if (typeof getFavorites !== 'function') {
    console.error('–§—É–Ω–∫—Ü–∏—è getFavorites –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
    return;
  }

  const favorites = getFavorites();
  const allRoutes = JSON.parse(localStorage.getItem('heritage_routes_v1') || '[]');
  const favoriteRoutes = allRoutes.filter(r => favorites.routes.includes(r.id));

  if (favoriteRoutes.length === 0) {
    container.style.display = 'none';
    emptyMsg.style.display = 'block';
    return;
  }

  container.style.display = 'block';
  emptyMsg.style.display = 'none';

  const estimateDurationFunc = typeof estimateDuration === 'function' ? estimateDuration : (count) => (count * 0.5).toFixed(1);

  container.innerHTML = favoriteRoutes.map(route => {
    const count = route.placeIds?.length || 0;
    const duration = route.durationHours || estimateDurationFunc(count);
    return `
      <article class="saved-route">
        <div>
          <h4>${route.name}</h4>
          <p>${count} –æ–±—ä–µ–∫—Ç–æ–≤, –ø—Ä–∏–º–µ—Ä–Ω–æ ${duration} —á.</p>
        </div>
        <div class="saved-route-actions">
          <button class="favorite-btn active" type="button" data-id="${route.id}" data-type="route" aria-label="–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ" title="–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
            </svg>
          </button>
          <button type="button" data-id="${route.id}" data-action="show">–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ</button>
          <button type="button" data-id="${route.id}" data-action="delete">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
      </article>
    `;
  }).join('');

  container.querySelectorAll('button[data-action]').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = Number(btn.dataset.id);
      const action = btn.dataset.action;
      const route = favoriteRoutes.find(r => r.id === id);

      if (action === 'show' && route) {
        localStorage.setItem('show_route_on_load', JSON.stringify({ 
          routeId: id, 
          routeName: route.name, 
          placeIds: route.placeIds || [],
          startPointId: route.startPointId || null,
          startPointCoords: route.startPointCoords || null
        }));
        window.location.href = '../index.html#map';
      } else if (action === 'delete' && route) {
        const allRoutes = JSON.parse(localStorage.getItem('heritage_routes_v1') || '[]');
        const updated = allRoutes.filter(r => r.id !== id);
        localStorage.setItem('heritage_routes_v1', JSON.stringify(updated));
        renderFavoritesRoutes();
      }
    });
  });

  container.querySelectorAll('.favorite-btn[data-type="route"]').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const id = Number(btn.dataset.id);
      if (typeof toggleRouteFavorite === 'function') {
        toggleRouteFavorite(id);
        renderFavoritesRoutes();
      }
    });
  });
}
</script>

<footer class="footer">
  <div class="container footer-inner footer__inner">
    <div class="footer-top footer__top">
      <div class="footer-logo footer__logo">
        <img src="../assets/img/logo.png" alt="HistoryTravel" class="footer-logo-img footer__logo-img">
        <div class="footer-logo-text footer__logo-text">
          <div class="footer-logo-title footer__logo-title">HistoryTravel</div>
          <div class="footer-logo-subtitle footer__logo-subtitle">–ö–∞—Ä—Ç–∞ –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–∏—è</div>
        </div>
      </div>
      <div class="footer-nav-columns footer__nav-columns">
        <div class="footer-nav-col footer__nav-col">
          <h4>–†–∞–∑–¥–µ–ª—ã —Å–∞–π—Ç–∞</h4>
          <nav class="footer-links footer__links">
            <a href="../index.html#map" class="footer__link">–ö–∞—Ä—Ç–∞</a>
            <a href="periods.html" class="footer__link">–≠–ø–æ—Ö–∏</a>
            <a href="routes.html" class="footer__link">–ú–∞—Ä—à—Ä—É—Ç—ã</a>
            <a href="gallery.html" class="footer__link">–ì–∞–ª–µ—Ä–µ—è</a>
          </nav>
        </div>
        <div class="footer-nav-col footer__nav-col">
          <h4>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</h4>
          <nav class="footer-links footer__links">
            <a href="favorites.html" class="footer__link">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
            <a href="about.html" class="footer__link">–û –ø—Ä–æ–µ–∫—Ç–µ</a>
            <a href="periods.html" class="footer__link">–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–∏–æ–¥—ã</a>
          </nav>
        </div>
      </div>
      <div class="footer-section footer__section footer-section--contacts">
        <h4>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h4>
        <div class="footer-contact footer__contact">
          <p class="footer-contact-item footer__contact-item">Email: <a href="mailto:nikita.stamoi@gmail.com" class="footer__link">nikita.stamoi@gmail.com</a></p>
          <p class="footer__text">Danich Nikita</p>
        </div>
      </div>
    </div>
    <div class="footer-social-section footer__social-section">
      <h3>–ú—ã –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö</h3>
      <div class="footer-social footer__social">
        <a href="https://telegram.org" target="_blank" rel="noopener noreferrer" aria-label="Telegram" class="footer__social-link">‚úà</a>
        <a href="https://vk.com" target="_blank" rel="noopener noreferrer" aria-label="–í–ö–æ–Ω—Ç–∞–∫—Ç–µ" class="footer__social-link">VK</a>
        <a href="https://instagram.com" target="_blank" rel="noopener noreferrer" aria-label="Instagram" class="footer__social-link">üì∑</a>
      </div>
    </div>
    <div class="footer-bottom footer__bottom">
      <p>&copy; 2025 HistoryTravel - –ö–∞—Ä—Ç–∞ –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞—Å–ª–µ–¥–∏—è —Ä–µ–≥–∏–æ–Ω–∞.</p>
    </div>
  </div>
</footer>
</body>
</html>

